---
title: "ğŸ‘©â€ğŸ’»ROS2 RealSense C++ Node"
toc: true
date: "2025-02-02"
description: C++ë¡œ ROS2 RealSense ì¹´ë©”ë¼ ë…¸ë“œ ë§Œë“¤ê¸° 
categories: [ros2, realsense, code]
execute:
  freeze: auto 
image: ../../images/2025-02-02-realsense-ros2/ros2_realsense.png
---

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” **Intel RealSense ì¹´ë©”ë¼ë¡œ ì´¬ì˜í•œ ë¹„ë””ì˜¤ë¥¼ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°í•˜ê³ **, ì˜ìƒì—ì„œ ê°ì§€í•œ **AprilTagì„ OpenCVë¥¼ í™œìš©í•´ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ROS 2 ê¸°ëŠ¥ì„ C++ ë…¸ë“œë¡œ êµ¬í˜„í•˜ëŠ” ì‹¤ìŠµ**ì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤. [AprilTag](https://april.eecs.umich.edu/software/apriltag)ëŠ” **ë¡œë´‡ ë¹„ì „, ì¦ê°• í˜„ì‹¤, ë§ˆì»¤ ê¸°ë°˜ ìœ„ì¹˜ ì¶”ì •** ë“±ì— í™œìš©ë˜ëŠ” íƒœê·¸ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë˜í•œ, ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” **RealSense ì¹´ë©”ë¼ë¥¼ ROS 2ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `librealsense2`ë¥¼ ì„¤ì •í•˜ëŠ” ê³¼ì •ê³¼ ì¼ë°˜ì ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¹Œë“œ ë¬¸ì œ í•´ê²° ë°©ë²•**ë„ í•¨ê»˜ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤.

<center>
<img src="../../images/2025-02-02-realsense-ros2/ros2_realsense.png" width="55%" />
</center>


ì´ ê°„ë‹¨í•œ ROS2 í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê¸° ì•ì„œ, ì•„ë˜ì˜ ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­ë“¤ì„ í™•ì¸í•´ì„œ ë¨¼ì € í™˜ê²½ì„ ì…‹íŒ…í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

::: {.callout-note collapse="true" icon="false"}

### ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­

- **ROS 2** (Galactic, Humble, Iron, etc. â€” ê°ì Ubuntu í™˜ê²½ì— ë§ëŠ” ROS2 versionì„ ì¤€ë¹„í•´ì£¼ì„¸ìš”)

- **Intel RealSense SDK (`librealsense2`)**

  - Ubuntuì—ì„œëŠ” ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

    ```bash
    sudo apt-get install librealsense2-dev
    ```

- **OpenCV** (e.g., `sudo apt-get install libopencv-dev`)

- **cv_bridge** (from `vision_opencv`) - ì¼ë°˜ì ìœ¼ë¡œ ROS 2 íŒ¨í‚¤ì§€ë¥¼ í†µí•´ ì„¤ì¹˜ë©ë‹ˆë‹¤:

  ```bash
  sudo apt-get install ros-${ROS_DISTRO}-vision-opencv
  ```

  ( `${ROS_DISTRO}` ë¶€ë¶„ì„ ê°ì ROS2 ë²„ì ¼ì— ë§ëŠ” ì´ë¦„ìœ¼ë¡œ ëŒ€ì²´í•´ì£¼ì„¸ìš”. e.g.) `galactic` or `humble`)

:::

## Overview

ì•ì„œ ì„¤ëª…í•œ ê²ƒì²˜ëŸ¼, ê°€ì¥ ë‹¨ìˆœí•œ ROS2 íŒ¨í‚¤ì§€ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ì§„í–‰í•  ì˜ˆì •ì…ë‹ˆë‹¤. 2ê°œì˜ C++ Nodeë“¤, ì¦‰ Publisherì™€ Subcriberë¥¼ ë§Œë“¤ì–´ Realsense Camera D457ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë³´ë‚´ì£¼ë©´(Publisher) ë°›ì€ ì´ë¯¸ì§€ë¥¼ í† ëŒ€ë¡œ Tag IDë¥¼ ì¸ì‹í•˜ì—¬ OpenCVë¡œ ê°„ë‹¨í•œ plotingì„ í•œ ì°½(Subsciber)ì„ ë„ì›Œë³¼ ì˜ˆì •ì…ë‹ˆë‹¤. ê° ë…¸ë“œë“¤ì˜ ì—­í• ì„ ì •ë¦¬í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

1. **Publisher Node**: RealSense ì¹´ë©”ë¼ì—ì„œ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ROS 2 í† í”½ìœ¼ë¡œ í¼ë¸”ë¦¬ì‹±í•˜ëŠ” ë…¸ë“œ
   - `librealsense2` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ RealSense cameraë¥¼ ì—°ê²°
   - 640Ã—480 í•´ìƒë„, 30 FPS ì¹¼ë¼ ì´ë¯¸ì§€ í”„ë ˆì„ì„ ìŠ¤íŠ¸ë¦¬ë°
   - ROS 2 í† í”½ìœ¼ë¡œ (`image_raw`) ì´ë¯¸ì§€ í”„ë ˆì„ Publish
   
2. **Subscriber Node**: RealSense ì¹´ë©”ë¼ì—ì„œ ì˜ìƒì„ ë°›ì•„ OpenCVë¡œ ì²˜ë¦¬í•˜ê³ , AprilTag ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ íƒœê·¸ë¥¼ ê°ì§€í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ë…¸ë“œ
   - `image_raw` í† í”½ì„ Subscribe
   - `cv_bridge`ë¥¼ ì´ìš©í•˜ì—¬ OpenCV `Mat`ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë³€í™˜
   - OpenCV windowì— ê°„ë‹¨í•œ í‘œì‹œë¥¼í•œ ì´ë¯¸ì§€ ë„ìš°ê¸°


<center>
<img src="../../images/2025-02-02-realsense-ros2/nodes.png" width="48%" />
</center>

## Creating the ROS 2 Package

`my_realsense_example` ë¼ëŠ” ìƒˆë¡œìš´ ROS 2 packageë¥¼ ë§Œë“¤ì–´ ì‹œì‘í•´ë³´ê² ìŠµë‹ˆë‹¤. ROS2ì˜ workspaceì— ìˆëŠ” `src/`í´ë”ì—ì„œ C++ íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤.

```bash {code-line-numbers=false}
cd ~/ros2_ws/src
ros2 pkg create my_realsense_example \
  --build-type ament_cmake \
  --dependencies rclcpp sensor_msgs cv_bridge
```

ê·¸ë‹¤ìŒ,  `my_realsense_example/src/` ì— ê° ë…¸ë“œì— ëŒ€í•œ C++ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.
- `realsense_publisher.cpp`
- `image_subscriber.cpp`

## Publisher Node: `realsense_publisher.cpp`

ìš°ì„ , ì¹´ë©”ë¼ ì„¼ì„œì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ ì†¡ì¶œí•˜ëŠ” **Publisher ë…¸ë“œ ì½”ë“œ**ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ë¨¼ì €, ì•„ë˜ì™€ ê°™ì´ í•„ìš”í•œ í—¤ë”ì™€ íŒ¨í‚¤ì§€ë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤.  

- `librealsense2/rs.hpp`: RealSense ì¹´ë©”ë¼ë¥¼ ì œì–´  
- `rclcpp/rclcpp.hpp`: ROS 2 ë…¸ë“œë¥¼ ìƒì„± ë° ê´€ë¦¬  
- `sensor_msgs/msg/image.hpp`: ROS 2ì˜ ì´ë¯¸ì§€ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬  
- `cv_bridge/cv_bridge.h`: ROS ë©”ì‹œì§€ì™€ OpenCV ì´ë¯¸ì§€ ê°„ ë³€í™˜  
- `opencv2/opencv.hpp`: OpenCV ê¸°ëŠ¥ í™œìš©  

ì´ëŸ¬í•œ ìš”ì†Œë“¤ì„ í¬í•¨í•˜ì—¬, RealSense ì¹´ë©”ë¼ì—ì„œ ì˜ìƒì„ ë°›ì•„ ROS 2 ë©”ì‹œì§€ë¡œ ë³€í™˜í•˜ê³  í¼ë¸”ë¦¬ì‹±í•˜ëŠ” ë…¸ë“œë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```cpp
#include <memory>
#include <chrono>
#include <librealsense2/rs.hpp>           // Intel RealSense SDK
#include "rclcpp/rclcpp.hpp"
#include "sensor_msgs/msg/image.hpp"     // ROS 2 Image message
#include "cv_bridge/cv_bridge.h"         // cv_bridge for ROS <-> OpenCV
#include "opencv2/opencv.hpp"            // OpenCV
```

ë³¸ê²©ì ìœ¼ë¡œ `RealSensePubliser`Classë¥¼ ì‚´í´ë³´ë©´, **RealSense ì¹´ë©”ë¼ì—ì„œ ìˆ˜ì§‘í•œ ì˜ìƒì„ OpenCV í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•œ í›„, ì´ë¥¼ ROS 2ì˜ ì´ë¯¸ì§€ ë©”ì‹œì§€ë¡œ ë³€í™˜í•˜ì—¬ ì£¼ê¸°ì ìœ¼ë¡œ í¼ë¸”ë¦¬ì‹±í•˜ëŠ” ê³¼ì •**ì´ ì§„í–‰ë©ë‹ˆë‹¤. ì´ í´ë˜ìŠ¤ ë…¸ë“œë¥¼ í†µí•´ ì†¡ì¶œëœ ì´ë¯¸ì§€ë¥¼ ë‹¤ë¥¸ ROS 2 ë…¸ë“œê°€ Subscribeí•˜ê³  í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í¬ê²Œ 2 ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **ë…¸ë“œ ì´ˆê¸°í™” (`RealSensePublisher`)**  
   - `rclcpp::Node`ë¥¼ ìƒì†ë°›ì•„ `"realsense_publisher"`ë¼ëŠ” ì´ë¦„ì˜ ROS 2 ë…¸ë“œë¥¼ ìƒì„±í•©
   - `rs2::pipeline`ì„ ì„¤ì •í•˜ì—¬ RealSense ì¹´ë©”ë¼ì—ì„œ ë°ì´í„°ë¥¼ ìŠ¤íŠ¸ë¦¬ë°í•  ì¤€ë¹„
   - `rs2::config`ë¥¼ ì‚¬ìš©í•´ ì»¬ëŸ¬ ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë°ì„ **640x480 í•´ìƒë„, BGR8 í¬ë§·, 30 FPS**ë¡œ ì„¤ì •
   - `create_publisher<sensor_msgs::msg::Image>("image_raw", 10);`ë¥¼ í†µí•´ `"image_raw"` í† í”½ìœ¼ë¡œ ì˜ìƒì„ í¼ë¸”ë¦¬ì‹±í•  í¼ë¸”ë¦¬ì…”ë¥¼ ìƒì„±
   - `create_wall_timer`ë¥¼ ì‚¬ìš©í•˜ì—¬ **100ms(ì•½ 10Hz) ê°„ê²©ìœ¼ë¡œ í”„ë ˆì„ì„ ê°€ì ¸ì™€ í¼ë¸”ë¦¬ì‹±í•˜ëŠ” íƒ€ì´ë¨¸**ë¥¼ ì„¤ì •

2. **í”„ë ˆì„ ìº¡ì²˜ ë° í¼ë¸”ë¦¬ì‹± (`publishFrame`)**  
   - `pipeline_->wait_for_frames();`ë¥¼ ì‚¬ìš©í•´ RealSense ì¹´ë©”ë¼ì—ì„œ ìƒˆë¡œìš´ í”„ë ˆì„ì„ ê°€ì ¸ì˜´
   - `frameset.get_color_frame();`ì„ í†µí•´ ì»¬ëŸ¬ í”„ë ˆì„ì„ ì¶”ì¶œí•˜ê³ , ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ê²½ê³  ë©”ì‹œì§€ë¥¼ ì¶œë ¥
   - `cv::Mat`ì„ ì‚¬ìš©í•˜ì—¬ RealSenseì˜ ì»¬ëŸ¬ í”„ë ˆì„ ë°ì´í„°ë¥¼ OpenCV í˜•ì‹ìœ¼ë¡œ ë³€í™˜
   - `cv_bridge::CvImage`ë¥¼ í™œìš©í•´ OpenCV ì´ë¯¸ì§€ë¥¼ ROS 2ì˜ `sensor_msgs::msg::Image` í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•œ í›„ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ í”„ë ˆì„ IDë¥¼ ì¶”ê°€
   - `publisher_->publish(*image_msg);`ë¥¼ í†µí•´ ë³€í™˜ëœ ì´ë¯¸ì§€ë¥¼ `"image_raw"` í† í”½ìœ¼ë¡œ í¼ë¸”ë¦¬ì‹±


```cpp
class RealSensePublisher : public rclcpp::Node
{
public:
  RealSensePublisher()
  : Node("realsense_publisher")
  {
    pipeline_ = std::make_shared<rs2::pipeline>();

    // Configure and start the pipeline to stream color images
    rs2::config cfg;
    cfg.enable_stream(RS2_STREAM_COLOR, 640, 480, RS2_FORMAT_BGR8, 30);
    pipeline_->start(cfg);

    publisher_ = this->create_publisher<sensor_msgs::msg::Image>("image_raw", 10);

    timer_ = this->create_wall_timer(
      std::chrono::milliseconds(100),  // ~10 Hz
      std::bind(&RealSensePublisher::publishFrame, this)
    );

    RCLCPP_INFO(this->get_logger(), "RealSense Publisher Node started.");
  }

private:
  void publishFrame()
  {
    // Wait for the next set of frames
    rs2::frameset frameset = pipeline_->wait_for_frames();
    rs2::video_frame color_frame = frameset.get_color_frame();
    if (!color_frame)
    {
      RCLCPP_WARN(this->get_logger(), "No color frame received.");
      return;
    }

    // Convert RealSense frame to OpenCV Mat
    cv::Mat color_image(
      cv::Size(color_frame.get_width(), color_frame.get_height()),
      CV_8UC3,
      (void*)color_frame.get_data(),
      cv::Mat::AUTO_STEP
    );

    // Convert to ROS Image message via cv_bridge
    auto image_msg = cv_bridge::CvImage(std_msgs::msg::Header(), "bgr8", color_image).toImageMsg();
    image_msg->header.stamp = this->get_clock()->now();
    image_msg->header.frame_id = "realsense_color_frame";

    publisher_->publish(*image_msg);
  }

  std::shared_ptr<rs2::pipeline> pipeline_;
  rclcpp::Publisher<sensor_msgs::msg::Image>::SharedPtr publisher_;
  rclcpp::TimerBase::SharedPtr timer_;
};

```

ë§ˆì§€ë§‰ìœ¼ë¡œ mainì—ì„œëŠ” ROS 2 ë…¸ë“œ ì‹¤í–‰ì˜ ì§„ì…ì ìœ¼ë¡œ, `RealSensePublisher` ë…¸ë“œë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ RealSense ì¹´ë©”ë¼ì—ì„œ ë°›ì€ ì˜ìƒì„ **ROS 2ì˜ `"image_raw"` í† í”½ìœ¼ë¡œ ì§€ì†ì ìœ¼ë¡œ í¼ë¸”ë¦¬ì‹±í•˜ëŠ” ë…¸ë“œ**ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

```cpp
int main(int argc, char *argv[])
{
  rclcpp::init(argc, argv); // ROS 2 ë…¸ë“œ ì‹¤í–‰ì„ ìœ„í•œ ì´ˆê¸°í™”

  rclcpp::spin(std::make_shared<RealSensePublisher>()); // `RealSensePublisher` ë…¸ë“œë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰
  /* 
  `spin()` í•¨ìˆ˜ëŠ” ë…¸ë“œê°€ ì§€ì†ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ ìœ ì§€í•˜ë©°, 
  ì½œë°± í•¨ìˆ˜(`publishFrame()`)ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í˜¸ì¶œí•˜ì—¬ RealSense ì¹´ë©”ë¼ì—ì„œ ì˜ìƒì„ ê°€ì ¸ì˜¤ê³  í¼ë¸”ë¦¬ì‹±í•©ë‹ˆë‹¤. 
  */

  rclcpp::shutdown(); // í”„ë¡œê·¸ë¨ ì¢…ë£Œ ì‹œ ROS 2ë¥¼ ì•ˆì „í•˜ê²Œ ì¢…ë£Œ
  return 0;
}
```

ê° ë¶€ë¶„ì„ ì‚´í´ë³¸ Publisher ë…¸ë“œë¥¼ í†µí•©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ `realsense_publisher.cpp`ê°€ ì™„ì„±ë©ë‹ˆë‹¤.

::: {.callout-note collapse="true" icon="false"}

### `realsense_publisher.cpp`

```cpp
#include <memory>
#include <chrono>
#include <librealsense2/rs.hpp>           // Intel RealSense SDK
#include "rclcpp/rclcpp.hpp"
#include "sensor_msgs/msg/image.hpp"     // ROS 2 Image message
#include "cv_bridge/cv_bridge.h"         // cv_bridge for ROS <-> OpenCV
#include "opencv2/opencv.hpp"            // OpenCV

class RealSensePublisher : public rclcpp::Node
{
public:
  RealSensePublisher()
  : Node("realsense_publisher")
  {
    pipeline_ = std::make_shared<rs2::pipeline>();

    // Configure and start the pipeline to stream color images
    rs2::config cfg;
    cfg.enable_stream(RS2_STREAM_COLOR, 640, 480, RS2_FORMAT_BGR8, 30);
    pipeline_->start(cfg);

    publisher_ = this->create_publisher<sensor_msgs::msg::Image>("image_raw", 10);

    timer_ = this->create_wall_timer(
      std::chrono::milliseconds(100),  // ~10 Hz
      std::bind(&RealSensePublisher::publishFrame, this)
    );

    RCLCPP_INFO(this->get_logger(), "RealSense Publisher Node started.");
  }

private:
  void publishFrame()
  {
    // Wait for the next set of frames
    rs2::frameset frameset = pipeline_->wait_for_frames();
    rs2::video_frame color_frame = frameset.get_color_frame();
    if (!color_frame)
    {
      RCLCPP_WARN(this->get_logger(), "No color frame received.");
      return;
    }

    // Convert RealSense frame to OpenCV Mat
    cv::Mat color_image(
      cv::Size(color_frame.get_width(), color_frame.get_height()),
      CV_8UC3,
      (void*)color_frame.get_data(),
      cv::Mat::AUTO_STEP
    );

    // Convert to ROS Image message via cv_bridge
    auto image_msg = cv_bridge::CvImage(std_msgs::msg::Header(), "bgr8", color_image).toImageMsg();
    image_msg->header.stamp = this->get_clock()->now();
    image_msg->header.frame_id = "realsense_color_frame";

    publisher_->publish(*image_msg);
  }

  std::shared_ptr<rs2::pipeline> pipeline_;
  rclcpp::Publisher<sensor_msgs::msg::Image>::SharedPtr publisher_;
  rclcpp::TimerBase::SharedPtr timer_;
};

int main(int argc, char *argv[])
{
  rclcpp::init(argc, argv);
  rclcpp::spin(std::make_shared<RealSensePublisher>());
  rclcpp::shutdown();
  return 0;
}
```

:::

## Subscriber Node: `image_subscriber.cpp`

ë‹¤ìŒìœ¼ë¡œ ìœ„ì—ì„œ Publisher ë…¸ë“œê°€ ë³´ë‚´ì¤€ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë°›ëŠ” Subscriber ë…¸ë“œì— ëŒ€í•´ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

ìš°ì„  ì•„ë˜ì™€ ê°™ì´ í•„ìš”í•œ í—¤ë” íŒŒì¼ë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤.  

1. **C++ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬í•¨ (`<memory>`, `<string>`, `<iostream>`)**  
   - ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°(`std::shared_ptr`), ë¬¸ìì—´(`std::string`), í‘œì¤€ ì…ì¶œë ¥(`std::cout`)ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í—¤ë” íŒŒì¼ 

2. **ROS 2 ê´€ë ¨ í—¤ë” í¬í•¨**  
   - `rclcpp/rclcpp.hpp`: ROS 2 ë…¸ë“œ ë° í¼ë¸”ë¦¬ì…”/êµ¬ë…ì ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
   - `sensor_msgs/msg/image.hpp`: ROS 2ì—ì„œ **ì´ë¯¸ì§€ ë©”ì‹œì§€(`sensor_msgs::msg::Image`)** ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•œ ë©”ì‹œì§€ íƒ€ì…  
   - `cv_bridge/cv_bridge.h`: **ROS ì´ë¯¸ì§€ ë©”ì‹œì§€ë¥¼ OpenCVì˜ `cv::Mat`ìœ¼ë¡œ ë³€í™˜**í•˜ê±°ë‚˜, ë°˜ëŒ€ë¡œ OpenCV ì´ë¯¸ì§€ë¥¼ ROS ë©”ì‹œì§€ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©

3. **OpenCV ê´€ë ¨ í—¤ë” í¬í•¨**  
   - `opencv2/highgui.hpp`: OpenCVì˜ GUI ê¸°ëŠ¥ (`cv::imshow()`, `cv::waitKey()`)ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•  ë•Œ í•„ìš”
   - `opencv2/imgproc.hpp`: ì´ë¯¸ì§€ ì²˜ë¦¬ ê¸°ëŠ¥(ì˜ˆ: í•„í„°ë§, ë³€í˜•, ìƒ‰ ë³€í™˜ ë“±)ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

4. **AprilTag ê°ì§€ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬í•¨**  
   - `extern "C" {}` ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ **C ìŠ¤íƒ€ì¼ë¡œ ì‘ì„±ëœ AprilTag ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ C++ ì½”ë“œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.**  
   - `#include <apriltag.h>`: AprilTag ê°ì§€ ì‹œìŠ¤í…œì˜ í•µì‹¬ í—¤ë”
   - `#include <tag25h9.h>`: **AprilTag 25h9 íƒœê·¸ ì„¸íŠ¸**ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í—¤ë” íŒŒì¼(25x9 í•´ìƒë„ë¥¼ ê°€ì§„ íƒœê·¸ ì„¸íŠ¸)
   - `#include <tag36h11.h>`ëŠ” ì£¼ì„ ì²˜ë¦¬ë˜ì–´ ìˆìœ¼ë©°, í•„ìš” ì‹œ **AprilTag 36h11 ì„¸íŠ¸(ë” ì •ë°€í•œ íƒœê·¸)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½ ê°€ëŠ¥**


```cpp
#include <memory>
#include <string>
#include <iostream>

// ROS 2
#include "rclcpp/rclcpp.hpp"
#include "sensor_msgs/msg/image.hpp"
#include "cv_bridge/cv_bridge.h"

// OpenCV
#include "opencv2/highgui.hpp"
#include "opencv2/imgproc.hpp"

// AprilTag library headers
extern "C" {
#include <apriltag.h>
// #include <tag36h11.h>
#include <tag25h9.h>
}
```

ë‹¤ìŒìœ¼ë¡œ `ImageSubscriber` Classë¥¼ ë³´ê² ìŠµë‹ˆë‹¤. RealSense ì¹´ë©”ë¼ì—ì„œ ìˆ˜ì‹ í•œ ì˜ìƒì„ ì²˜ë¦¬í•˜ê³ , AprilTagì„ ê²€ì¶œí•˜ì—¬ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ROS 2 ë…¸ë“œë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. OpenCVë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ìƒì„ ë³€í™˜í•˜ê³ , AprilTag ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ íƒœê·¸ë¥¼ ê°ì§€ ë° ì‹œê°í™”í•˜ì—¬ ê²€ì¶œëœ íƒœê·¸ì˜ ID, ê¼­ì§“ì , ì¤‘ì‹¬ì„ í™”ë©´ì— ì‹œê°ì ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ê³¼ì •ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í¬ê²Œ ì„¸ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì„œ ë³´ë©´,

**1. ë…¸ë“œ ì´ˆê¸°í™” (`ImageSubscriber`)**  

- `"image_raw"` í† í”½ì„ êµ¬ë…(`subscription_`)í•˜ì—¬ ì¹´ë©”ë¼ ì˜ìƒì„ ìˆ˜ì‹ 
- OpenCV ì°½ `"RealSense Camera + AprilTag"`ë¥¼ ìƒì„±í•˜ì—¬ í™”ë©´ì— ì˜ìƒì„ í‘œì‹œí•  ì¤€ë¹„
- **AprilTag ê²€ì¶œê¸° ì´ˆê¸°í™”**:  
  - `tag_family_ = tag25h9_create();` â†’ AprilTag 25h9 íƒœê·¸ ì„¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •
  - `tag_detector_ = apriltag_detector_create();` â†’ AprilTag ê²€ì¶œê¸°ë¥¼ ìƒì„±
  - `apriltag_detector_add_family(tag_detector_, tag_family_);` â†’ íŠ¹ì • íƒœê·¸ íŒ¨ë°€ë¦¬ë¥¼ ê²€ì¶œê¸°ì— ì¶”ê°€
  - ê²€ì¶œê¸°ì˜ ë§¤ê°œë³€ìˆ˜(ì˜ˆ: `quad_decimate`, `quad_sigma`)ë¥¼ ì¡°ì •í•˜ì—¬ ì„±ëŠ¥ ìµœì í™” ê°€ëŠ¥

**2. ì´ë¯¸ì§€ ìˆ˜ì‹  ë° AprilTag ê²€ì¶œ (`imageCallback`)**: ROS 2ì˜ `"image_raw"` í† í”½ì—ì„œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ê°€ ìˆ˜ì‹ ë  ë•Œ í˜¸ì¶œ

1. **ROS 2 ì´ë¯¸ì§€ ë©”ì‹œì§€ â†’ OpenCV `cv::Mat` ë³€í™˜**  
   - `cv_bridge::toCvCopy(msg, "bgr8")->image;`ë¥¼ ì‚¬ìš©í•˜ì—¬ ROS 2ì˜ `sensor_msgs::msg::Image`ë¥¼ OpenCV í˜•ì‹(`cv::Mat`)ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤
   - ë³€í™˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬

2. **ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜** (AprilTag ê²€ì¶œì€ í‘ë°± ì˜ìƒì´ í•„ìš”)  
   - `cv::cvtColor(frame, gray, cv::COLOR_BGR2GRAY);`  

3. **OpenCV `cv::Mat` â†’ AprilTag ì „ìš© ì´ë¯¸ì§€ í˜•ì‹ (`image_u8_t`) ë³€í™˜**  
   - AprilTag ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `image_u8_t` êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë³€í™˜ì´ í•„ìš”
   - `gray.data`ë¥¼ `buf`ë¡œ ì „ë‹¬í•˜ì—¬ ë©”ëª¨ë¦¬ ë³µì‚¬ë¥¼ ìµœì†Œí™”

4. **AprilTag ê²€ì¶œ ì‹¤í–‰**  
   - `apriltag_detector_detect(tag_detector_, &apriltag_image);`ì„ í˜¸ì¶œí•˜ì—¬ AprilTagì„ ê°ì§€
   - ê²€ì¶œëœ íƒœê·¸ëŠ” `zarray_t* detections`ì— ì €ì¥

5. **ê²€ì¶œëœ AprilTagì— ëŒ€í•œ ì‹œê°ì  í‘œì‹œ**  
   - ê° íƒœê·¸ì˜ **ë„¤ ê°œì˜ ê¼­ì§“ì  ì¢Œí‘œ(`p[]`)** ë¥¼ ê°€ì ¸ì™€ ì´ˆë¡ìƒ‰(`cv::Scalar(0, 255, 0)`)ìœ¼ë¡œ ì‚¬ê°í˜•ì„ ê·¸ë¦¼
   - íƒœê·¸ì˜ **ì¤‘ì•™ ì¢Œí‘œ(`c[]`)** ì— ë¹¨ê°„ìƒ‰ ì›ì„ í‘œì‹œ(`cv::circle()`)
   - íƒœê·¸ì˜ **IDë¥¼ ë…¸ë€ìƒ‰(`cv::Scalar(0, 255, 255)`) í…ìŠ¤íŠ¸ë¡œ í™”ë©´ì— ì¶œë ¥**

6. **ë©”ëª¨ë¦¬ ì •ë¦¬**  
   - `apriltag_detections_destroy(detections);`ë¥¼ í˜¸ì¶œí•˜ì—¬ ê²€ì¶œëœ íƒœê·¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì •ë¦¬í•˜ì—¬ **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€**

7. **ê²°ê³¼ ì´ë¯¸ì§€ í‘œì‹œ**  
   - `cv::imshow("RealSense Camera + AprilTag", frame);`ì„ í†µí•´ ê²€ì¶œ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œ
   - `cv::waitKey(1);`ë¥¼ í˜¸ì¶œí•˜ì—¬ OpenCV ì°½ì´ ë°˜ì‘í•˜ë„ë¡ ìœ ì§€


**3. ë…¸ë“œ ì¢…ë£Œ ì‹œ AprilTag ë¦¬ì†ŒìŠ¤ ì •ë¦¬ (`~ImageSubscriber()`)**  

- `apriltag_detector_remove_family(tag_detector_, tag_family_);` â†’ ê²€ì¶œê¸°ì—ì„œ íŒ¨ë°€ë¦¬ë¥¼ ì œê±°
- `apriltag_detector_destroy(tag_detector_);` â†’ ê²€ì¶œê¸° ì‚­ì œ
- `tag25h9_destroy(tag_family_);` â†’ íƒœê·¸ íŒ¨ë°€ë¦¬ ë©”ëª¨ë¦¬ í•´ì œ


```cpp
class ImageSubscriber : public rclcpp::Node
{
public:
  ImageSubscriber()
  : Node("image_subscriber")
  {
    subscription_ = this->create_subscription<sensor_msgs::msg::Image>(
      "image_raw",
      10,
      std::bind(&ImageSubscriber::imageCallback, this, std::placeholders::_1)
    );

    // Create an OpenCV window once
    cv::namedWindow("RealSense Camera", cv::WINDOW_AUTOSIZE);

    RCLCPP_INFO(this->get_logger(), "Image Subscriber Node started.");
  }

private:
  void imageCallback(const sensor_msgs::msg::Image::SharedPtr msg)
  {
    cv::Mat frame;
    try
    {
      frame = cv_bridge::toCvCopy(msg, "bgr8")->image;
    }
    catch (cv_bridge::Exception &e)
    {
      RCLCPP_ERROR(this->get_logger(), "cv_bridge exception: %s", e.what());
      return;
    }

    if (!frame.empty())
    {
      cv::imshow("RealSense Camera", frame);
      cv::waitKey(1);
    }
  }

  rclcpp::Subscription<sensor_msgs::msg::Image>::SharedPtr subscription_;
};
```

ë§ˆì§€ë§‰ìœ¼ë¡œ mainì„ ì‚´í´ë³´ë©´ ROS 2 ì´ë¯¸ì§€ êµ¬ë… ë…¸ë“œ(`ImageSubscriber`)ë¥¼ ì‹¤í–‰í•˜ëŠ” ë©”ì¸ í•¨ìˆ˜ë¡œ, ROS 2 ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ê´€ë¦¬í•˜ë©° ì´ë¯¸ì§€ êµ¬ë… ë…¸ë“œë¥¼ ì‹¤í–‰í•˜ë©´ì„œ 30Hzì˜ ì£¼ê¸°ë¡œ ROS ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.


```cpp
int main(int argc, char *argv[])
{
  rclcpp::init(argc, argv); // ROS 2 ë…¸ë“œë¥¼ ì‹¤í–‰í•  ì¤€ë¹„
  auto node = std::make_shared<ImageSubscriber>(); // ë…¸ë“œ ìƒì„±: `ImageSubscriber` ë…¸ë“œë¥¼ ìƒì„±í•˜ì—¬ RealSense ì¹´ë©”ë¼ì—ì„œ í¼ë¸”ë¦¬ì‹±ë˜ëŠ” `"image_raw"` í† í”½ì„ êµ¬ë…í•  ì¤€ë¹„

  rclcpp::Rate rate(30); // ì´ˆë‹¹ 30íšŒ(30Hz) ì‹¤í–‰
  while (rclcpp::ok()) // ì£¼ê¸°ì  ì‹¤í–‰ ë£¨í”„
  {
    rclcpp::spin_some(node); // ë…¸ë“œê°€ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ê³ , ì½œë°± í•¨ìˆ˜(`imageCallback`)ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. 
    rate.sleep(); // ë£¨í”„ê°€ 30Hzì˜ ì¼ì •í•œ ì£¼ê¸°ë¡œ ì‹¤í–‰ë˜ë„ë¡ ëŒ€ê¸°
  }

  rclcpp::shutdown(); // í”„ë¡œê·¸ë¨ ì¢…ë£Œ ì‹œ ROS 2ë¥¼ ì•ˆì „í•˜ê²Œ ì¢…ë£Œ
  return 0;
}

```

ê° ë¶€ë¶„ì„ ì‚´í´ë³¸ Subsciber ë…¸ë“œë¥¼ í†µí•©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ `image_subscriber.cpp`ê°€ ì™„ì„±ë©ë‹ˆë‹¤.

::: {.callout-note collapse="true" icon="false"}

### `image_subscriber.cpp`

```cpp
#include <memory>
#include <string>
#include <iostream>

// ROS 2
#include "rclcpp/rclcpp.hpp"
#include "sensor_msgs/msg/image.hpp"
#include "cv_bridge/cv_bridge.h"

// OpenCV
#include "opencv2/highgui.hpp"
#include "opencv2/imgproc.hpp"

// AprilTag library headers
extern "C" {
#include <apriltag.h>
// #include <tag36h11.h>
#include <tag25h9.h>
}

class ImageSubscriber : public rclcpp::Node
{
public:
  ImageSubscriber()
  : Node("image_subscriber")
  {
    subscription_ = this->create_subscription<sensor_msgs::msg::Image>(
      "image_raw",
      10,
      std::bind(&ImageSubscriber::imageCallback, this, std::placeholders::_1)
    );

    // Create an OpenCV window once
    cv::namedWindow("RealSense Camera + AprilTag", cv::WINDOW_AUTOSIZE);

    RCLCPP_INFO(this->get_logger(), "Image Subscriber Node started.");

    // Initialize the AprilTag detector
    // tag_family_ = tag36h11_create();  // Create specific tag family (36h11)
    tag_family_ = tag25h9_create(); // Create specific tag family (36h11)
    tag_detector_ = apriltag_detector_create();
    apriltag_detector_add_family(tag_detector_, tag_family_);

    // Optionally adjust detection parameters
    // e.g., tag_detector_->quad_decimate = 1.0; // For performance
    //       tag_detector_->quad_sigma = 0.0;
    // etc.
  }

  ~ImageSubscriber()
  {
    // Cleanup AprilTag resources
    apriltag_detector_remove_family(tag_detector_, tag_family_);
    apriltag_detector_destroy(tag_detector_);
    // tag36h11_destroy(tag_family_);
    tag25h9_destroy(tag_family_);
  }

private:
  void imageCallback(const sensor_msgs::msg::Image::SharedPtr msg)
  {
    // 1. Convert ROS Image to OpenCV Mat
    cv::Mat frame;
    try
    {
      frame = cv_bridge::toCvCopy(msg, "bgr8")->image;
    }
    catch (cv_bridge::Exception &e)
    {
      RCLCPP_ERROR(this->get_logger(), "cv_bridge exception: %s", e.what());
      return;
    }

    // 2. Convert color to grayscale (AprilTag needs grayscale)
    cv::Mat gray;
    cv::cvtColor(frame, gray, cv::COLOR_BGR2GRAY);

    // 3. Convert OpenCV Mat to the format required by AprilTag library
    //    (AprilTag library uses its own image type: image_u8_t)
    image_u8_t apriltag_image = {
      .width  = gray.cols,
      .height = gray.rows,
      .stride = static_cast<int>(gray.step),
      .buf    = gray.data
    };

    // 4. Detect tags
    zarray_t* detections = apriltag_detector_detect(tag_detector_, &apriltag_image);

    // 5. For each detection, draw a bounding box on the image
    for (int i = 0; i < zarray_size(detections); i++)
    {
      apriltag_detection_t *det;
      zarray_get(detections, i, &det);

      // Access the four corners of the AprilTag
      // p[] is in image coordinates (x=horizontal, y=vertical)
      cv::Point corners[4];
      for (int c = 0; c < 4; c++)
      {
        corners[c] = cv::Point(det->p[c][0], det->p[c][1]);
      }

      // Draw lines between corners
      for (int c = 0; c < 4; c++)
      {
        cv::line(frame, corners[c], corners[(c+1)%4], cv::Scalar(0, 255, 0), 2);
      }

      // Draw the tag center
      cv::circle(frame,
                 cv::Point(det->c[0], det->c[1]),
                 5, cv::Scalar(0, 0, 255), -1);

      // Put tag ID text near the center
      std::string text = "ID: " + std::to_string(det->id);
      cv::putText(frame, text,
                  cv::Point(det->c[0] + 10, det->c[1] + 10),
                  cv::FONT_HERSHEY_SIMPLEX,
                  0.5,
                  cv::Scalar(0, 255, 255),
                  2);
    }

    // Always remember to destroy detection array to avoid memory leaks
    apriltag_detections_destroy(detections);

    // 6. Show the image
    cv::imshow("RealSense Camera + AprilTag", frame);
    cv::waitKey(1);
  }

  rclcpp::Subscription<sensor_msgs::msg::Image>::SharedPtr subscription_;

  // AprilTag fields
  apriltag_family_t *tag_family_;
  apriltag_detector_t *tag_detector_;
};

int main(int argc, char *argv[])
{
  rclcpp::init(argc, argv);

  auto node = std::make_shared<ImageSubscriber>();

  // Spin in a loop so that callbacks can be processed
  rclcpp::Rate rate(30);
  while (rclcpp::ok())
  {
    rclcpp::spin_some(node);
    rate.sleep();
  }

  rclcpp::shutdown();
  return 0;
}
```
:::

## CMakeLists.txt Configuration

ê·¸ ë‹¤ìŒìœ¼ë¡œ ROS2 íŒ¨í‚¤ì§€ ë¹Œë“œì— ëŒ€í•œ ë‚´ìš©ì„ ë‹´ê³  ìˆëŠ” `CMakeLists.txt` íŒŒì¼ì„ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.
`CMakeLists.txt` ( `my_realsense_example` ë£¨íŠ¸ì— ìœ„ì¹˜)ì—ì„œ RealSense ì¹´ë©”ë¼ì—ì„œ ì´ë¯¸ì§€ë¥¼ í¼ë¸”ë¦¬ì‹±í•˜ê³ , AprilTagì„ ê²€ì¶œí•˜ëŠ” ROS 2 ë…¸ë“œë“¤ì„ ë¹Œë“œ ë° ì„¤ì¹˜í•˜ëŠ” ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤. defaultë¡œ ìƒì„±ë˜ì–´ìˆë˜ ë‚´ìš©ì„ ì•„ë˜ ë‚´ìš©ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤.

```cmake
cmake_minimum_required(VERSION 3.8)
project(realsense_apriltag_pubsub)

find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)
find_package(sensor_msgs REQUIRED)
find_package(cv_bridge REQUIRED)
find_package(OpenCV REQUIRED)
find_package(realsense2 REQUIRED)
find_package(apriltag REQUIRED)  # <-- Add this!

include_directories(
  include
  ${OpenCV_INCLUDE_DIRS}
)

# Publisher
add_executable(realsense_publisher src/realsense_publisher.cpp)
ament_target_dependencies(realsense_publisher
  rclcpp
  sensor_msgs
  cv_bridge
)
target_link_libraries(realsense_publisher
  ${OpenCV_LIBS}
  realsense2
)

# Subscriber with AprilTag
add_executable(image_subscriber src/image_subscriber.cpp)
ament_target_dependencies(image_subscriber
  rclcpp
  sensor_msgs
  cv_bridge
)
target_link_libraries(image_subscriber
  ${OpenCV_LIBS}
  realsense2
  apriltag          # <-- Link AprilTag
)

install(TARGETS
  realsense_publisher
  image_subscriber
  DESTINATION lib/${PROJECT_NAME}
)

# Install the launch directory
install(DIRECTORY launch/
  DESTINATION share/${PROJECT_NAME}/launch
)

ament_package()
```

ì´ `CMakeLists.txt`ëŠ” **RealSense ì¹´ë©”ë¼ì—ì„œ ì´ë¯¸ì§€ë¥¼ í¼ë¸”ë¦¬ì‹±í•˜ëŠ” ë…¸ë“œì™€, í•´ë‹¹ ì˜ìƒì„ êµ¬ë…í•˜ì—¬ AprilTagì„ ê²€ì¶œí•˜ëŠ” ë…¸ë“œë¥¼ ë¹Œë“œ**í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. íŠ¹íˆ, `apriltag` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ **AprilTag ê²€ì¶œ ê¸°ëŠ¥ì´ í¬í•¨ëœ êµ¬ë…ì(`image_subscriber`) ë…¸ë“œë¥¼ ì§€ì›í•˜ëŠ” ê²ƒì´ íŠ¹ì§•**ì…ë‹ˆë‹¤.  

**1. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì°¾ê¸° (`find_package`)**  

- `ament_cmake`, `rclcpp`, `sensor_msgs`, `cv_bridge`, `OpenCV`, `realsense2` ë“±ì˜ íŒ¨í‚¤ì§€ë¥¼ í¬í•¨í•˜ì—¬ **ROS 2, OpenCV, RealSense SDKë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •**
- **AprilTag ì¶”ê°€ (`find_package(apriltag REQUIRED)`)**  
  - AprilTag ê²€ì¶œì„ ìœ„í•´ `apriltag` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í•„ìˆ˜ì ìœ¼ë¡œ í¬í•¨

**2. í—¤ë” í¬í•¨ ê²½ë¡œ ì„¤ì • (`include_directories`)**  

- `include/` í´ë”ì™€ OpenCVì˜ í—¤ë” íŒŒì¼ì´ í¬í•¨ëœ ë””ë ‰í† ë¦¬ë¥¼ ì¶”ê°€

**3. í¼ë¸”ë¦¬ì…” ì‹¤í–‰ íŒŒì¼ ìƒì„± (`realsense_publisher`)**  

- `src/realsense_publisher.cpp` íŒŒì¼ì„ **ë¹Œë“œí•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ í¼ë¸”ë¦¬ì…” ë…¸ë“œ ìƒì„±**
- `ament_target_dependencies(realsense_publisher ...)`ë¥¼ í†µí•´ ROS 2 ë¼ì´ë¸ŒëŸ¬ë¦¬(`rclcpp`, `sensor_msgs`, `cv_bridge`)ì™€ì˜ ì˜ì¡´ì„±ì„ ì„¤ì •
- `target_link_libraries(realsense_publisher ${OpenCV_LIBS} realsense2)`ì„ ì‚¬ìš©í•´ OpenCV ë° RealSense SDKë¥¼ ë§í¬

**4. êµ¬ë…ì(AprilTag í¬í•¨) ì‹¤í–‰ íŒŒì¼ ìƒì„± (`image_subscriber`)**  

- `src/image_subscriber.cpp` íŒŒì¼ì„ ë¹Œë“œí•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ë…ì ë…¸ë“œ ìƒì„±
- `ament_target_dependencies(image_subscriber ...)`ë¥¼ í†µí•´ ROS 2 ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„± ì¶”ê°€
- `target_link_libraries(image_subscriber ${OpenCV_LIBS} realsense2 apriltag)`ì„ í†µí•´ OpenCV, RealSense SDK, AprilTag ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§í¬í•˜ì—¬ **AprilTag ê²€ì¶œ ê¸°ëŠ¥ì„ í™œì„±í™”**

**5. ì‹¤í–‰ íŒŒì¼ ì„¤ì¹˜ (`install(TARGETS ...)`)**  

- ë¹Œë“œëœ ì‹¤í–‰ íŒŒì¼(`realsense_publisher`, `image_subscriber`)ì„ ROS 2 íŒ¨í‚¤ì§€ì˜ ì‹¤í–‰ ê°€ëŠ¥ ê²½ë¡œì— ë°°í¬

**6. Launch íŒŒì¼ ì„¤ì¹˜ (`install(DIRECTORY launch/ ...)`)**  

- `launch/` ë””ë ‰í† ë¦¬ë¥¼ ROS 2 íŒ¨í‚¤ì§€ì˜ `share/` ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•˜ì—¬ ì‹¤í–‰ ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
- ì´ë¥¼ í†µí•´ `ros2 launch realsense_apriltag_pubsub some_launch_file.py` í˜•íƒœë¡œ ì‹¤í–‰ ê°€ëŠ¥

**7. íŒ¨í‚¤ì§€ ì„ ì–¸ (`ament_package()`)**  

- `ament_package()`ë¥¼ í˜¸ì¶œí•˜ì—¬ **ROS 2 ë¹Œë“œ ì‹œìŠ¤í…œ(`ament_cmake`)ê³¼ í˜¸í™˜ë˜ë„ë¡ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì •**

### âš ï¸ë°œìƒí•  ìˆ˜ ìˆëŠ” Build ì—ëŸ¬ ì´ìŠˆë“¤

- **Undefined reference to `rs2_â€¦`**: `realsense2` libraryë¥¼ ë§í¬í•˜ì§€ ì•Šì•˜ì„ ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì…ë‹ˆë‹¤. `find_package(realsense2 REQUIRED)`ì™€ `target_link_libraries(... realsense2)`ê°€ `CMakeLists.txt`ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. 
- **Cannot find `image_subscriber.cpp`**: `CMakeLists.txt`ì—ì„œ ì§€ì •í•œ íŒŒì¼ ì´ë¦„ê³¼ ê²½ë¡œê°€ `src/` í´ë” ë‚´ì˜ ì‹¤ì œ íŒŒì¼ê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
- **cv_bridge or OpenCV not found**: `package.xml`ì— ì‘ì„±ë˜ì–´ ìˆëŠ” ë””íœë˜ì‹œë“¤ì„ í™•ì¸í•˜ê³ , í”„ë¡œê·¸ë˜ë°í•˜ëŠ” í™˜ê²½ ì‹œìŠ¤í…œì— `cv_bridge` ì™€ OpenCVê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

## Build & ì‹¤í–‰

ì´ì œ íŒ¨í‚¤ì§€ë¥¼ ë¹Œë“œí•  ëª¨ë“  ì¤€ë¹„ëŠ” ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ ì†ŒìŠ¤ ì½”ë“œë“¤ì„ ì‘ì„±í•œ workspace ê²½ë¡œ(e.g., `~/ros2_ws`)ë¡œ ì´ë™í•˜ì—¬ ë¹Œë“œí•´ì¤ë‹ˆë‹¤.

```bash {code-line-numbers=false}
colcon build --packages-select my_realsense_example
source install/setup.bash
```

ì˜ ë¹Œë“œê°€ ë˜ì—ˆë‹¤ë©´ í„°ë¯¸ë„ì„ 2ê°œ ë„ì›Œì„œ ê°ê° publisher ì™€ subscriber ë…¸ë“œë¥¼ ì‹¤í–‰ì‹œì¼œ ì¤ë‹ˆë‹¤.

- **Terminal 1**:  
  ```bash {code-line-numbers=false}
  ros2 run my_realsense_example realsense_publisher
  ```
- **Terminal 2**:  
  ```bash {code-line-numbers=false}
  ros2 run my_realsense_example image_subscriber
  ```

ê·¸ëŸ¬ë©´ **â€œRealSense Camera + AprilTagâ€** ì°½ì´ ë‚˜ì˜¤ë©´ì„œ ì¸ì‹ëœ AprilTag IDì™€ ë°•ìŠ¤ê°€ í‘œì‹œëœ ì°½ì´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¬ ê²ƒ ì…ë‹ˆë‹¤!

<center>
<img src="../../images/2025-01-13-realsense-ros2/realsense_april.png" width="48%" />
    <figcaption>ìµœì¢… ê²°ê³¼ë¬¼</figcaption>
</center>

## Conclusion

ì´ì œ RealSense ì¹´ë©”ë¼ì—ì„œ ì»¬ëŸ¬ í”„ë ˆì„ì„ í¼ë¸”ë¦¬ì‹±í•˜ê³ , ì´ë¥¼ OpenCV ì°½ì— í‘œì‹œí•˜ëŠ” ìµœì†Œí•œì˜ ROS 2 ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤. ë‹¨ìˆœíˆ ì˜ìƒì„ ìˆ˜ì‹ í•˜ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼, AprilTag ì¸ì‹ì„ í™œìš©í•˜ì—¬ ê°„ë‹¨í•œ ì´ë¯¸ì§€ í›„ì²˜ë¦¬ë„ ìˆ˜í–‰í•´ ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ë¥¼ í™•ì¥í•˜ë©´ ë¡œë³´í‹±ìŠ¤ì—ì„œ í•„ìš”í•œ **ìœ„ì¹˜ ì¶”ì •ê³¼ ê°™ì€ ê³ ê¸‰ ê¸°ëŠ¥**ë„ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë©°, ê¹Šì´ í”„ë ˆì„, í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ë“± **RealSenseì—ì„œ ì§€ì›í•˜ëŠ” ë‹¤ì–‘í•œ ìŠ¤íŠ¸ë¦¼ì„ í™œìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤**. ì´ë²ˆ ì‹¤ìŠµì„ í†µí•´ **ROS 2ì—ì„œ C++ ê¸°ë°˜ íŒ¨í‚¤ì§€ë¥¼ ë¹Œë“œí•˜ê³  í™œìš©í•˜ëŠ” ê³¼ì •ì— ëŒ€í•œ ì´í•´ë¥¼ ë•ê³ **, ë” ë³µì¡í•œ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” í”„ë¡œì íŠ¸ë¡œ ë‚˜ì•„ê°€ëŠ” ë° ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.