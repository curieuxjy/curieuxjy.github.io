---
title: "ğŸ“Async vs Sync in Python"
jupyter: python3
toc: true
date: "2025-10-20"
description: Async defì— ëŒ€í•´ ì•Œì•„ë³´ê¸°
categories: [python, async, 2025]
format:
  html:
    mermaid:
      theme: dark
execute:
  echo: true
  warning: true
---

`async def`ì™€ `def`ì˜ ì°¨ì´ëŠ” **í•¨ìˆ˜ì˜ ì‹¤í–‰ ë°©ì‹(ë™ê¸° vs ë¹„ë™ê¸°)**ì— ìˆì–´ìš”.

## ğŸ§© ê¸°ë³¸ ê°œë…

| êµ¬ë¶„ | `def` (ì¼ë°˜ í•¨ìˆ˜) | `async def` (ë¹„ë™ê¸° í•¨ìˆ˜) |
|---|---|---|
| ì‹¤í–‰ ë°©ì‹ | **ë™ê¸°(Synchronous)** | **ë¹„ë™ê¸°(Asynchronous)** |
| ë°˜í™˜ ê°’ | ì¼ë°˜ì ì¸ ê°’ (ì˜ˆ: `int`, `list`) | **ì½”ë£¨í‹´ ê°ì²´ (`coroutine`)** |
| ì‹¤í–‰ ì‹œì  | ì¦‰ì‹œ ì‹¤í–‰ë˜ì–´ ê²°ê³¼ë¥¼ ë°˜í™˜ | ì‹¤í–‰ë˜ì§€ë§Œ **`await`ë¡œ ê¸°ë‹¤ë ¤ì•¼** ì‹¤ì œ ê²°ê³¼ë¥¼ ì–»ìŒ |

---

## âš™ï¸ ì˜ˆì‹œ ë¹„êµ

### (1) ì¼ë°˜ í•¨ìˆ˜ (`def`)

```{python}
#| eval: true
def greet():
    return "Hello"

result = greet()
print(result)
```

> `def`ëŠ” í˜¸ì¶œë˜ë©´ ë°”ë¡œ ì‹¤í–‰ë˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•´ìš”.


### (2) ë¹„ë™ê¸° í•¨ìˆ˜ (`async def`)

```{python}
#| eval: true
import asyncio

async def greet():
    return "Hello"

result = greet()
print(result)
```


- `async def`ë¡œ ì •ì˜ëœ í•¨ìˆ˜ëŠ” **ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ**
- ëŒ€ì‹  â€œì½”ë£¨í‹´(coroutine)â€ ê°ì²´ë¥¼ ë°˜í™˜
- ì‹¤ì œ ì‹¤í–‰í•˜ë ¤ë©´ `await` ë˜ëŠ” `asyncio.run()`ì„ ì¨ì•¼ í•¨

---

#### `await`ë¡œ ì‹¤í–‰í•˜ê¸°

```{python}
#| eval: false
import asyncio  # âœ… asyncio: íŒŒì´ì¬ì˜ ë¹„ë™ê¸°(Asynchronous) í”„ë¡œê·¸ë˜ë°ì„ ì§€ì›í•˜ëŠ” í‘œì¤€ ëª¨ë“ˆ

# ============================================================
# â‘  ì½”ë£¨í‹´(Coroutine) ì •ì˜
# ============================================================
# async def ë¡œ ì •ì˜ëœ í•¨ìˆ˜ëŠ” ì¼ë°˜ í•¨ìˆ˜ì²˜ëŸ¼ ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ.
# í˜¸ì¶œ ì‹œ 'ì½”ë£¨í‹´ ê°ì²´(coroutine object)'ë¥¼ ë°˜í™˜í•˜ê³ ,
# ì´ ê°ì²´ë¥¼ ì´ë²¤íŠ¸ ë£¨í”„(event loop)ê°€ ìŠ¤ì¼€ì¤„ë§í•´ì„œ ì‹¤ì œë¡œ ì‹¤í–‰í•¨.
async def greet():
    # ì´ í•¨ìˆ˜ëŠ” ë‹¨ìˆœíˆ "Hello" ë¬¸ìì—´ì„ ë°˜í™˜í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜
    return "Hello"


# ============================================================
# â‘¡ ë©”ì¸ ì½”ë£¨í‹´ (ë‹¤ë¥¸ ì½”ë£¨í‹´ì„ í˜¸ì¶œí•˜ê³  ê´€ë¦¬)
# ============================================================
async def main():
    # await í‚¤ì›Œë“œëŠ” 'ì½”ë£¨í‹´ ì‹¤í–‰ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦°ë‹¤'ëŠ” ì˜ë¯¸.
    # greet()ë¥¼ í˜¸ì¶œí•˜ë©´ ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ì½”ë£¨í‹´ ê°ì²´ë¥¼ ë°˜í™˜í•¨.
    # await greet()ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì—ê²Œ "ì´ ì½”ë£¨í‹´ì„ ì‹¤í–‰í•˜ê³  ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤˜"ë¼ê³  ìš”ì²­í•¨.
    result = await greet()

    # greet()ì˜ ì‹¤í–‰ì´ ì™„ë£Œë˜ë©´, resultì—ëŠ” "Hello"ê°€ ì €ì¥ë¨.
    print(result)  # ì½˜ì†”ì— "Hello" ì¶œë ¥


# ============================================================
# â‘¢ ì´ë²¤íŠ¸ ë£¨í”„(Event Loop)
# ============================================================
# asyncio.run()ì€ íŒŒì´ì¬ 3.7ë¶€í„° ë„ì…ëœ ê³ ìˆ˜ì¤€ APIë¡œ,
# ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ ìˆ˜í–‰í•¨:
#
#  1ï¸âƒ£ ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ë£¨í”„ ìƒì„±
#  2ï¸âƒ£ main() ì½”ë£¨í‹´ì„ ë£¨í”„ì— ë“±ë¡í•˜ê³  ì‹¤í–‰ ì‹œì‘
#  3ï¸âƒ£ await êµ¬ë¬¸ ë“±ì„ í†µí•´ ë‹¤ë¥¸ ì½”ë£¨í‹´ë“¤ì„ ìŠ¤ì¼€ì¤„ë§í•˜ì—¬ ì‹¤í–‰ ìˆœì„œë¥¼ ê´€ë¦¬
#  4ï¸âƒ£ ëª¨ë“  ì½”ë£¨í‹´ì´ ì™„ë£Œë˜ë©´ ë£¨í”„ë¥¼ ì •ë¦¬í•˜ê³  ì¢…ë£Œ
#
# ì¦‰, í”„ë¡œê·¸ë¨ ì „ì²´ì˜ ë¹„ë™ê¸° ì‘ì—…ì„ ì´ê´„í•˜ëŠ” "ì¡°ì •ì" ì—­í• ì„ í•¨.
asyncio.run(main())
```

ğŸ“Œ ì‹¤í–‰ ê²°ê³¼

```
Hello
```

ì´ë²¤íŠ¸ ë£¨í”„ ë‚´ë¶€ êµ¬ì„±ì„ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```{mermaid}
%%| echo: false

flowchart TD
    %% =============================
    %% asyncio (High-level)
    %% =============================
    subgraph A["asyncio (ê³ ìˆ˜ì¤€ API)"]
        A1["asyncio.run(main)"]
        A2["ë£¨í”„ ìƒì„± ë°<br>run_until_complete(Task(main))"]
        A3["Task<br>ì½”ë£¨í‹´ ì‹¤í–‰ ë‹¨ìœ„<br>(ìƒíƒœ/ì½œë°±/ìŠ¤íƒ ë³´ìœ )"]
        A4["Future<br>ê²°ê³¼Â·ì˜ˆì™¸ ì €ì¥, ì½œë°± ë“±ë¡ ê°€ëŠ¥"]

        A1 --> A2
        A2 --> A3
        A2 --> A4
    end

    %% =============================
    %% Event Loop ë‚´ë¶€ êµ¬ì¡°
    %% =============================
    subgraph B["Event Loop (ë‹¨ì¼ ìŠ¤ë ˆë“œ, í˜‘ë ¥í˜• ì „í™˜)"]
        direction LR
        B1["Ready Queue"]
        B2["Callback Queue"]
        B3["ì‹¤í–‰ ë‹¨ê³„<br>(í•œ í‹±ì”© Task ì‹¤í–‰)"]
        B5["Selector / IO<br>(epoll, kqueue)"]
        B6["íƒ€ì´ë¨¸ í™<br>(ì§€ì—° ì½œë°±, sleep)"]

        B1 <-->|"ì½œë°± ì´ë™"| B2
        B2 -->|"run_ready()"| B3
        B5 <-->|"poll(timeout)"| B3
        B3 --> B6
    end

    %% =============================
    %% Control Flow
    %% =============================
    A3 -. "await" .-> B3
    B3 -. "I/O ì™„ë£ŒÂ·íƒ€ì´ë¨¸ ë§Œë£Œ" .-> B1
    B1 -->|"Task ì¬ê°œ"| A3


```

---

## â±ï¸ ì–¸ì œ `async def`ë¥¼ ì¨ì•¼ í• ê¹Œ?

ë¹„ë™ê¸°ëŠ” **I/O ì‘ì—…(ì…ì¶œë ¥)**ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì—ì„œ ìœ ìš©í•©ë‹ˆë‹¤.

* ë„¤íŠ¸ì›Œí¬ ìš”ì²­ (`HTTP request`)
* íŒŒì¼ ì½ê¸°/ì“°ê¸°
* ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
* ëŒ€ê¸° ì‹œê°„(`sleep`)ì´ ë§ì€ ì½”ë“œ

```{python}
#| eval: false
import asyncio

async def download():
    print("ë‹¤ìš´ë¡œë“œ ì‹œì‘")
    await asyncio.sleep(2)   # ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸°
    print("ë‹¤ìš´ë¡œë“œ ì™„ë£Œ")

async def main():
    await asyncio.gather(download(), download(), download())

asyncio.run(main())
```

ğŸ“Œ ì‹¤í–‰ ê²°ê³¼

```
ë‹¤ìš´ë¡œë“œ ì‹œì‘
ë‹¤ìš´ë¡œë“œ ì‹œì‘
ë‹¤ìš´ë¡œë“œ ì‹œì‘
(2ì´ˆ í›„)
ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
```

> ì„¸ ê°œê°€ ë™ì‹œì— ì‹¤í–‰ë˜ì–´ **ì´ 2ì´ˆë§Œ ê±¸ë ¤ìš”!**
> ë§Œì•½ `def`ì˜€ë‹¤ë©´ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ì–´ 6ì´ˆê°€ ê±¸ë ¸ì„ ê²ë‹ˆë‹¤.



| í•­ëª©    | `def`        | `async def`                  |
| ----- | ------------ | ---------------------------- |
| ì‹¤í–‰ ì‹œì  | ì¦‰ì‹œ ì‹¤í–‰        | ì½”ë£¨í‹´ ê°ì²´ ë°˜í™˜                    |
| ë°˜í™˜ ê°’  | ì¼ë°˜ ê°’         | `coroutine`                  |
| ê²°ê³¼ ë°›ê¸° | ë°”ë¡œ ê°€ëŠ¥        | `await` í•„ìš”                   |
| ì£¼ ìš©ë„  | CPU ì—°ì‚° ì¤‘ì‹¬ ì½”ë“œ | I/O ì¤‘ì‹¬(ëŒ€ê¸° ë§ì€) ì½”ë“œ             |
| ë³‘ë ¬ ì²˜ë¦¬ | ì–´ë µë‹¤          | `asyncio.gather()` ë“±ìœ¼ë¡œ ì‰½ê²Œ ê°€ëŠ¥ |

---

<!--
ì´ì œë¶€í„°ëŠ” **ì‹¤ì œë¡œ ì‹¤í–‰ë˜ëŠ” ë°ëª¨**ë¥¼ ë³´ì—¬ì¤„ê²Œìš”.
Quarto/Jupyterì—ì„œì˜ ì´ë²¤íŠ¸ ë£¨í”„ ì¶©ëŒì„ í”¼í•˜ê¸° ìœ„í•´ `nest_asyncio`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.


> âœ… ì‹¤í–‰ ì¤€ë¹„

```{python code-fold="true"}
import sys, subprocess, importlib

def ensure(pkg: str):
    try:
        importlib.import_module(pkg)
    except ImportError:
        subprocess.check_call([sys.executable, "-m", "pip", "install", pkg])

ensure("nest_asyncio")
```

-->

## ğŸš€ ë™ê¸° vs ë¹„ë™ê¸° ì‹¤í–‰ ë°ëª¨

```{python}
import asyncio
import time

# ------------------ ë™ê¸° (def) ------------------
def sync_task(name):
    print(f"{name} ì‹œì‘")
    time.sleep(2)
    print(f"{name} ì™„ë£Œ")

def sync_main():
    start = time.time()
    for i in range(3):
        sync_task(f"ì‘ì—… {i+1}")
    print(f"ì´ ì†Œìš” ì‹œê°„(ë™ê¸°): {time.time() - start:.2f}ì´ˆ")

# ------------------ ë¹„ë™ê¸° (async def) ------------------
async def async_task(name):
    print(f"{name} ì‹œì‘")
    await asyncio.sleep(2)
    print(f"{name} ì™„ë£Œ")

async def async_main():
    start = time.time()
    await asyncio.gather(*[async_task(f"ì‘ì—… {i+1}") for i in range(3)])
    print(f"ì´ ì†Œìš” ì‹œê°„(ë¹„ë™ê¸°): {time.time() - start:.2f}ì´ˆ")

print("\n=== ë™ê¸° ì‹¤í–‰ ===")
sync_main()

print("\n=== ë¹„ë™ê¸° ì‹¤í–‰ ===")
# ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ë£¨í”„ì—ì„œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰ (top-level await)
await async_main()
```

## ğŸ” ê²°ê³¼ í•´ì„

* **ë™ê¸°(`def`)**: 1â†’2â†’3 ìˆœì°¨ ì‹¤í–‰ â†’ ì•½ **6ì´ˆ**
* **ë¹„ë™ê¸°(`async def`)**: 3ê°œ ë™ì‹œ ì‹¤í–‰ â†’ ì•½ **2ì´ˆ**

ë¹„ë™ê¸°ëŠ” **ëŒ€ê¸°(I/O)** ì‹œê°„ì´ ë§ì€ ì‘ì—…ì—ì„œ í° ì´ì ì„ ì œê³µí•©ë‹ˆë‹¤.
