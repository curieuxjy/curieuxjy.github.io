---
title: "ğŸ“Async vs Sync in Python"
jupyter: python3
toc: true
date: "2025-10-20"
description: Async defì— ëŒ€í•´ ì•Œì•„ë³´ê¸°
categories: [python, async, 2025]
format: html
execute:
  echo: true
  warning: true
---

`async def`ì™€ `def`ì˜ ì°¨ì´ëŠ” **í•¨ìˆ˜ì˜ ì‹¤í–‰ ë°©ì‹(ë™ê¸° vs ë¹„ë™ê¸°)**ì— ìˆì–´ìš”.

## ğŸ§© 1. ê¸°ë³¸ ê°œë…

| êµ¬ë¶„ | `def` (ì¼ë°˜ í•¨ìˆ˜) | `async def` (ë¹„ë™ê¸° í•¨ìˆ˜) |
|---|---|---|
| ì‹¤í–‰ ë°©ì‹ | **ë™ê¸°(Synchronous)** | **ë¹„ë™ê¸°(Asynchronous)** |
| ë°˜í™˜ ê°’ | ì¼ë°˜ì ì¸ ê°’ (ì˜ˆ: `int`, `list`) | **ì½”ë£¨í‹´ ê°ì²´ (`coroutine`)** |
| ì‹¤í–‰ ì‹œì  | ì¦‰ì‹œ ì‹¤í–‰ë˜ì–´ ê²°ê³¼ë¥¼ ë°˜í™˜ | ì‹¤í–‰ë˜ì§€ë§Œ **`await`ë¡œ ê¸°ë‹¤ë ¤ì•¼** ì‹¤ì œ ê²°ê³¼ë¥¼ ì–»ìŒ |

---

## âš™ï¸ 2. ì˜ˆì‹œ ë¹„êµ

### (1) ì¼ë°˜ í•¨ìˆ˜ (`def`)

```{python}
#| eval: false
def greet():
    return "Hello"

result = greet()
print(result)
````

ğŸ“Œ ì‹¤í–‰ ê²°ê³¼

```bash
Hello
```

> `def`ëŠ” í˜¸ì¶œë˜ë©´ ë°”ë¡œ ì‹¤í–‰ë˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•´ìš”.


### (2) ë¹„ë™ê¸° í•¨ìˆ˜ (`async def`)

```{python}
#| eval: false
import asyncio

async def greet():
    return "Hello"

result = greet()
print(result)
```

ğŸ“Œ ì‹¤í–‰ ê²°ê³¼

```bash
<coroutine object greet at 0x7f...>
```

> `async def`ë¡œ ì •ì˜ëœ í•¨ìˆ˜ëŠ” **ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•Šì•„ìš”.**
> ëŒ€ì‹  â€œì½”ë£¨í‹´(coroutine)â€ ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
> ì‹¤ì œ ì‹¤í–‰í•˜ë ¤ë©´ `await` ë˜ëŠ” `asyncio.run()`ì„ ì¨ì•¼ í•´ìš”.

---

### (3) `await`ë¡œ ì‹¤í–‰í•˜ê¸°

```{python}
#| eval: false
import asyncio

async def greet():
    return "Hello"

async def main():
    result = await greet()
    print(result)

asyncio.run(main())
```

ğŸ“Œ ì‹¤í–‰ ê²°ê³¼

```
Hello
```

---

## â±ï¸ 3. ì–¸ì œ `async def`ë¥¼ ì¨ì•¼ í• ê¹Œ?

ë¹„ë™ê¸°ëŠ” **I/O ì‘ì—…(ì…ì¶œë ¥)**ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ìƒí™©ì—ì„œ ìœ ìš©í•©ë‹ˆë‹¤.

ì˜ˆ:

* ë„¤íŠ¸ì›Œí¬ ìš”ì²­ (`HTTP request`)
* íŒŒì¼ ì½ê¸°/ì“°ê¸°
* ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
* ëŒ€ê¸° ì‹œê°„(`sleep`)ì´ ë§ì€ ì½”ë“œ

```{python}
#| eval: false
import asyncio

async def download():
    print("ë‹¤ìš´ë¡œë“œ ì‹œì‘")
    await asyncio.sleep(2)   # ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸°
    print("ë‹¤ìš´ë¡œë“œ ì™„ë£Œ")

async def main():
    await asyncio.gather(download(), download(), download())

asyncio.run(main())
```

ğŸ“Œ ì‹¤í–‰ ê²°ê³¼

```
ë‹¤ìš´ë¡œë“œ ì‹œì‘
ë‹¤ìš´ë¡œë“œ ì‹œì‘
ë‹¤ìš´ë¡œë“œ ì‹œì‘
(2ì´ˆ í›„)
ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
```

> ì„¸ ê°œê°€ ë™ì‹œì— ì‹¤í–‰ë˜ì–´ **ì´ 2ì´ˆë§Œ ê±¸ë ¤ìš”!**
> ë§Œì•½ `def`ì˜€ë‹¤ë©´ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ì–´ 6ì´ˆê°€ ê±¸ë ¸ì„ ê²ë‹ˆë‹¤.

---

## ğŸ§  ìš”ì•½

| í•­ëª©    | `def`        | `async def`                  |
| ----- | ------------ | ---------------------------- |
| ì‹¤í–‰ ì‹œì  | ì¦‰ì‹œ ì‹¤í–‰        | ì½”ë£¨í‹´ ê°ì²´ ë°˜í™˜                    |
| ë°˜í™˜ ê°’  | ì¼ë°˜ ê°’         | `coroutine`                  |
| ê²°ê³¼ ë°›ê¸° | ë°”ë¡œ ê°€ëŠ¥        | `await` í•„ìš”                   |
| ì£¼ ìš©ë„  | CPU ì—°ì‚° ì¤‘ì‹¬ ì½”ë“œ | I/O ì¤‘ì‹¬(ëŒ€ê¸° ë§ì€) ì½”ë“œ             |
| ë³‘ë ¬ ì²˜ë¦¬ | ì–´ë µë‹¤          | `asyncio.gather()` ë“±ìœ¼ë¡œ ì‰½ê²Œ ê°€ëŠ¥ |

---

<!--
ì´ì œë¶€í„°ëŠ” **ì‹¤ì œë¡œ ì‹¤í–‰ë˜ëŠ” ë°ëª¨**ë¥¼ ë³´ì—¬ì¤„ê²Œìš”.
Quarto/Jupyterì—ì„œì˜ ì´ë²¤íŠ¸ ë£¨í”„ ì¶©ëŒì„ í”¼í•˜ê¸° ìœ„í•´ `nest_asyncio`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
-->

> âœ… ì‹¤í–‰ ì¤€ë¹„ (í•„ìš”ì‹œ ì„¤ì¹˜ â†’ ì ìš©)

```{python code-fold="true"}
import sys, subprocess, importlib

def ensure(pkg: str):
    try:
        importlib.import_module(pkg)
    except ImportError:
        subprocess.check_call([sys.executable, "-m", "pip", "install", pkg])

ensure("nest_asyncio")
```

## ğŸš€ ë™ê¸° vs ë¹„ë™ê¸° ì‹¤í–‰ ë°ëª¨

```{python}
import asyncio
import time
import nest_asyncio

# Jupyter/Quarto ì´ë²¤íŠ¸ ë£¨í”„ ì¤‘ì²© í—ˆìš©
nest_asyncio.apply()

# ------------------ ë™ê¸° (def) ------------------
def sync_task(name):
    print(f"{name} ì‹œì‘")
    time.sleep(2)
    print(f"{name} ì™„ë£Œ")

def sync_main():
    start = time.time()
    for i in range(3):
        sync_task(f"ì‘ì—… {i+1}")
    print(f"ì´ ì†Œìš” ì‹œê°„(ë™ê¸°): {time.time() - start:.2f}ì´ˆ")

# ------------------ ë¹„ë™ê¸° (async def) ------------------
async def async_task(name):
    print(f"{name} ì‹œì‘")
    await asyncio.sleep(2)
    print(f"{name} ì™„ë£Œ")

async def async_main():
    start = time.time()
    await asyncio.gather(*[async_task(f"ì‘ì—… {i+1}") for i in range(3)])
    print(f"ì´ ì†Œìš” ì‹œê°„(ë¹„ë™ê¸°): {time.time() - start:.2f}ì´ˆ")

print("\n=== ë™ê¸° ì‹¤í–‰ ===")
sync_main()

print("\n=== ë¹„ë™ê¸° ì‹¤í–‰ ===")
# ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ë£¨í”„ì—ì„œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰ (top-level await)
await async_main()
```

## ğŸ” ê²°ê³¼ í•´ì„

* **ë™ê¸°(`def`)**: 1â†’2â†’3 ìˆœì°¨ ì‹¤í–‰ â†’ ì•½ **6ì´ˆ**
* **ë¹„ë™ê¸°(`async def`)**: 3ê°œ ë™ì‹œ ì‹¤í–‰ â†’ ì•½ **2ì´ˆ**

ë¹„ë™ê¸°ëŠ” **ëŒ€ê¸°(I/O)** ì‹œê°„ì´ ë§ì€ ì‘ì—…ì—ì„œ í° ì´ì ì„ ì œê³µí•©ë‹ˆë‹¤.
